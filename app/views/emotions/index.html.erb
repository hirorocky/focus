<div class="container">
  <div class="level">
    <div class="level-left"><h1 class="title">過去のキモチ</h1></div>
    <div class="level-right"><%= link_to '新しいキモチ', new_emotion_path, class: 'button is-link' %></div>
  </div>
  <% if @emotions.count == 0 %>
    <div class="level" id="introduce-create-emotion">
      <div class="level-item">
        まだキモチがありません。右上のボタンから新しいキモチを登録できます。
      </div>
    </div>
  <% else %>
    <script>
        let sketch;// emotion.eachループで繰り返し代入するため
    </script>

    <% @emotions.each do |emotion| %>
      <div class="box emotion"> <!-- .emotionはテスト用 -->
        <div class="media-left" style="float:left" id="emotion-<%= emotion.id %>"></div>

        <div class="media-content">
          <div class="content">
            <h5><%= emotion.name %></h5>
            <h6><%= emotion.created_at %></h6>
          </div>
          <nav class="level-right">
            <%= link_to "削除", emotion,
                        method: :delete,
                        data: { confirm: "キモチ「#{emotion.name}」を削除します。よろしいですか？"},
                        class: "btn btn-secondary"
            %>
          </nav>
        </div>
      </div>

      <script>
          sketch = p => {
              const emo_color = "<%= emotion.color %>"; //ただの"const color=..."だと競合する
              const shape = "<%= emotion.shape %>";
              p.setup = () => {
                  p.createCanvas(100, 100, p.WEBGL);
              };

              p.draw = () => {
                  p.background(0);
                  p.rotateZ(p.frameCount * 0.001);
                  p.rotateX(p.frameCount * 0.001);
                  p.rotateY(p.frameCount * 0.001);

                  p.ambientLight(50);
                  p.pointLight(250, 250, 250, 100, 100, 30);
                  // p.specularMaterial(emo_color);
                  p.stroke(emo_color);
                  p.fill(emo_color);

                  switch (shape) {
                      case "1":
                          p.sphere(40);
                          break;
                      case "2":
                          p.box(40,40,40);
                          break;
                  }
              };
          };

          new p5(sketch, "emotion-<%= emotion.id %>");
      </script>
    <% end %>
  <% end %>
</div>

